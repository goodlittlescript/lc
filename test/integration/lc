#!/bin/bash
. test/integration/helper

setup_template_file () {
template_name="example"
template_file="$ts_test_dir/$template_name.erb"
mkdir -p "$ts_test_dir"
printf "%s" "$1" > "$template_file"
printf "%s\n" "$template_file"
}

test_lc_renders_file_with_args () {
setup_template_file "1 + 2 = <%= args.map(&:to_i).inject(0, &:+) %>"
lc "$template_file" 1 2 | assert_output "1 + 2 = 3"
}

test_lc_assigns_args_a_generic_name () {
setup_template_file "1 + 2 = <%= arg0.to_i + arg1.to_i %>"
lc "$template_file" 1 2 | assert_output "1 + 2 = 3"
}

test_lc_looks_up_template_file_along_LC_PATH () {
setup_template_file "<%= 1 + 2 %>"
export LC_PATH="$ts_test_dir"
lc "$template_name" | assert_output "3"
}

test_lc_prints_error_if_template_cannot_be_found_on_LC_PATH () {
export LC_PATH="$ts_test_dir"
lc missing 2>&1 | assert_output "\
could not find template: \"missing\"
"
}

#
# -h
#

test_lc_h_prints_help () {
lc -h | grep -q "usage: lc"
}

. ts
